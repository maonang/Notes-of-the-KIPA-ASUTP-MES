@echo off
rem Включаем режим локальных переменных и отложенное расширение
rem enabledelayedexpansion нужно для корректной работы с переменными внутри циклов for
setlocal enabledelayedexpansion

rem Устанавливаем кодовую страницу 1251 для поддержки кириллических символов в путях
rem >nul скрывает вывод служебной информации
chcp 1251 >nul

rem Сохраняем текущую директорию в переменную root
rem Это позволит выводить относительные пути вместо абсолютных
set "root=%cd%"

rem Запускаем цикл по всем файлам в текущей директории и поддиректориях
rem /b - вывод только имен файлов (bare format)
rem /s - рекурсивный поиск во всех поддиректориях
rem /a-d - исключить директории, оставить только файлы
rem "delims=" - важно для обработки путей с пробелами
(for /f "delims=" %%i in ('dir /b /s /a-d') do (
    rem Сохраняем полный путь текущего файла во временную переменную
    set "file=%%i"
    
    rem Выводим путь файла, удаляя из него часть с текущей директорией
    rem Синтаксис !var:old=new! заменяет подстроку 'old' на 'new'
    rem Здесь мы заменяем '%root%\' на пустую строку, получая относительный путь
    echo !file:%root%\=!
)) > list.txt

rem Завершаем локальный контекст, возвращая все переменные в исходное состояние
endlocal

rem Скрипт создает файл list.txt с относительными путями ко всем файлам