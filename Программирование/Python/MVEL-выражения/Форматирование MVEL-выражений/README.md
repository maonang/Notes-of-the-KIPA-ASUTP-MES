# Форматирование MVEL-выражений
  
## Описание
Предназначена для форматирования однострочных MVEL-выражений. Помогает устранять распространенные ошибки форматирования и синтаксиса, а также предоставляет обобщенную статистику по структуре выражения.  
  
## Назначение
Программа позволяет:
- Форматировать сложное однострочное MVEL-выражение в читаемый многострочный вид с отступами.
- Преобразовывать отформатированный код обратно в компактное однострочное выражение.
- Проводить анализ выражения на предмет синтаксических ошибок и неявных объявлений.
  
# Возможности
## Анализ и Статистика
- **Обработка JSON-выгрузок**: Работает с полными конфигурациями объектной модели (ОМ) из  системы ZIIoT, извлекая и анализируя MVEL-выражение.
- **Определение переменных**:
  - Определяет явно объявленные локальные переменные (с указанием типа данных) и группирует их по типам.
  - Определяет глобальные переменные (атрибуты), используемые в выражении (в том числе из JSON-выгрузки).
  - Выявляет локальные переменные, используемые без явного объявления типа данных.
- **Результат выражения**: Определяет переменные и выражения, которые потенциально являются результатом выполнения всего MVEL-выражения (по признаку отсутствия оператора присваивания "=").
- **Информация о теге и запуске**: Извлекает из JSON-выгрузки идентификатор целевого тега (tagId) и тип запуска выражения (triggerType), включая период и сдвиг для периодического запуска.

## Коррекция и форматирование
- **Пробелы и Переносы**: Удаляет лишние пробелы, символы табуляции и переносы строк. Добавляет недостающие пробелы вокруг операторов (+, *, >), кроме оператора минуса.
- **Синтаксические Ошибки (с коррекцией)**:
  - **Разделитель чисел**: Исправляет разделитель вещественных чисел с `,` на `.`.
  - **Экспонента**: Переводит символ экспоненты (e) в верхний регистр (E).
  - ** Оператор сравнения**: Исправляет оператор присваивания = на оператор сравнения == в блоках if.
  - **Скобки в if**: Исправляет пропущенные скобки на краях логических выражений (if (условие)).
- **Синтаксические Ошибки (без коррекции)**:
  - Проверяет четность количества скобок по каждому виду: ( ), [ ], { }.
  - Проверяет четность количества кавычек по каждому виду: " и '.

## Управление и удобство
- **Файлы вывода**: Результаты сохраняются в:
  - `output_format.txt`: отформатированное и скорректированное MVEL-выражение.
  - `output_info.txt`: обобщенная статистика и информация об ошибках.
- **Команды консоли*: Удобные команды для работы с файлами.

# Принцип работы  
Программа работает в интерактивном режиме через консоль:
1. **Ввод данных**:
  - **Вручную/Буфер**: Пользователь вводит MVEL-выражение или вставляет полную JSON-выгрузку прямо в консоль.
  - Файл `input.txt`: MVEL-выражение может быть предварительно сохранено в файл `input.txt`.
2. **Обработка (Команда 1)**:
- Выражение из `input.txt` проходит предварительную очистку (`def_pre_change_text`).
- Выполняется поиск и исправление ошибок (`def_code_correct`, `def_find_if`).
- Проводится анализ переменных (`def_var_all`, `def_var_local`).
- Код форматируется с отступами (`def_code_formatting`).
- Результаты сохраняются в `output_format.txt` и `output_info.txt`.
3. **Обратная конвертация (Команда 2)**:
- Позволяет взять исправленное и отформатированное выражение из `output_format.txt` и преобразовать его обратно в компактную однострочную форму для использования в системах.
4. **Команды**: Используются для просмотра и редактирования файлов.

# Список команд
- `0` - Выход из программы;
- `1` - Отформатировать MVEL-выражение: `input.txt` -> `output_info.txt` и `output_format.txt`;
- `2` - Преобразовать исправленное отформатированное MVEL-выражение в одну строку: `output_format.txt` -> `output_info.txt`;
- `+n` - Открыть в блокноте файлы `output_format.txt` и `output_info.txt`;
- `+ni` - Открыть в блокноте файл `input.txt`;
- `-n` - Завершить все процессы `notepad.exe`. Проверено на Windows 10;
- `+i` - Отобразить содержимое файла `output_info.txt` в консоли;
- `+f` - Отобразить содержимое файла `output_format.txt` в консоли;
- `help` - Отобразить список команд.
